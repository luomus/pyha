{% extends "pyha/base/requestview_base.html" %}
{% load i18n %}

{% block end_script %}
	{% if coordinates %}
	<script>
		$(document).ready(function(){
			$('[data-toggle="tooltip"]').tooltip();
			initializeMap();
			map.setView([{{coordinates.5}}, {{coordinates.6}}], 7);
			document.getElementById('filters').style.display = 'block';
			map.invalidateSize();
			document.getElementById('filters').style.display = '';
			var bounds = [[{{coordinates.0}}, {{coordinates.2}}], [{{coordinates.1}},{{coordinates.3}}]];
			L.rectangle(bounds, {color: "#ff7800", weight: 1}).addTo(map);
		});
	</script>
	{% endif %}
	{% if next == 'comments' %}
	<script>
		$(document).ready(function(){
			document.getElementById('commentform').scrollIntoView();
		});
	</script>
	{% endif %}
	<script>
		function showDecline() {
			var x = document.getElementById('sensitive_refuse_form');
			if (x.style.display == 'none') {
				x.style.display = 'block';
			}
		}
	</script>
	<script>
		function refreshCommunicationsEmailByLang() {
			var x = document.getElementById('admin_com_email_lang');
			var strLang = x.options[x.selectedIndex].value;

			if (strLang == 'all'){
				document.getElementById('com_email_header').value = document.getElementById('com_email_header_fi').innerHTML;
				document.getElementById('com_email_content').value = '{%trans "in_other_languages_below"%}\n\n\n\n';
				{% for lang in languages %}
				document.getElementById('com_email_content').value += document.getElementById('com_email_content_{{ lang.code }}').innerHTML;
				document.getElementById('com_email_content').value += '\n\n------------------------------------';
					{% if not forloop.last %}
						document.getElementById('com_email_content').value += '\n\n\n';
					{% endif %}
				{% endfor %}
			} else {
				document.getElementById('com_email_header').value = document.getElementById('com_email_header_'+strLang).innerHTML;
				document.getElementById('com_email_content').value = document.getElementById('com_email_content_'+strLang).innerHTML;
			}

		}
	</script>
	<script>
		function enableCommunicationsEmail() {
			var x = document.querySelectorAll('[name^=email_id_]');
			var b = false;
			for (i = 0; i < x.length; i++){
				if(x[i].checked){
					b = true;
					break;
				}
			}
			{% if not userRequest.frozen %}
			document.getElementById('submit_email').disabled = !b;
			{% endif %}

		}
	</script>
	{% if next == 'information' %}
	<script>
		$(document).ready(function(){
			document.getElementById('additional_information').scrollIntoView();
			document.getElementById('requestform').scrollIntoView();
		});
	</script>
	{% endif %}
	{% if next == 'communications' %}
	<script>
		$(document).ready(function(){
			document.getElementById('handler_communications-tab').scrollIntoView();
		});
	</script>
	{% endif %}
	{% if next == 'decision' %}
	<script>
		$(document).ready(function(){
			document.getElementById('decision-tab').scrollIntoView();
		});
	</script>
	{% endif %}
	<script>
		$(document).ready(function(){
			refreshCommunicationsEmailByLang();
			enableCommunicationsEmail();
		});
	</script>
{% endblock %}
