{% extends "pyha/base/base.html" %}
{% load i18n %}
{% block content %}

<div class="container-fluid">
  <div class="row">
    <div class="col-xs-12">
      <div class="page-header">
        {% include "pyha/skipofficial/requestview_header.html" %}
      </div>

  		<div class="col-xs-12">
  			{% if collections %}
  			<h2 style="text-align:center;top:0%;">{% trans "restricted" %}</h2>
  			<div>
  			<table class="table">
  				{% for collection in collections %}
  					<tr>
  					<td>{{collection.result.collectionName}} <small>[<a href="{{tun_link}}{{collection.address}}" target="_blank">{% trans 'to_metadata' %}</a>]</small></td>
  					<td>
  					<div class="slider-group" style="text-align:center;">
  						<span class="slider slider-{{role}}{% if collection.status == 1 %}-light{% endif %}">
                {% if role == "handler" %}
    								{% if collection.address in handles %}
    									{% trans "handler_waiting_for_you" %}
    								{% else %}
    									{% trans "handler_waiting_for_others" %}
    								{% endif %}
                {% else %}
                  {% trans "waiting_for_data_provider" %}
                {% endif %}
              </span>
  						<span class="slider slider-{{role}}{% if collection.status == 4 %}-light{% endif %}">{% trans "accepted" %}</span>
  						<span class="slider slider-{{role}}{% if collection.status == 3 %}-light{% endif %}">{% trans "denied" %}</span>
  					</div>
  					</td>
  				</tr>
  				{% endfor %}
  			</table>
  			</div>
  			{% endif %}
  		</div>

      {% if role == "user" %}
      <div class="col-xs-12">
				{% if userRequest.status == 8 %}
					{% if downloadable %}
						<div style="text-align:center;">
						<a href="{{download}}" type="button" class="btn btn-default btn-lg" style="line-height:20px;width:100%; max-width:500px;"><span class="glyphicon glyphicon-open-file"></span> {% trans 'download' %}</a>
						</div>
					{% else %}
						<h3 style="text-align:center;">{% trans 'download_has_expired' %}</h3>
					{% endif %}
				{% elif userRequest.status == 4  %}
				<div style="text-align:center;">
					<form action="{% url 'pyha:initializeDownload' %}" method="post">
						<button style="width:100%; max-width:500px;" class="btn btn-default btn-lg " style="line-height:20px;width:100%; max-width:500px;">{% trans 'initialize_download' %}</button>
						<input type="hidden" id="requestid" name="requestid" value={{userRequest.id}}>
						<input type="hidden" id="next" name="next" value={{request.path}}>
						{% csrf_token %}
					</form>
				</div>
				{% elif userRequest.status == 7%}
				<h3 style="text-align:center;">{% trans 'you_will_be_emailed_when_ready' %}</h3>
				{% elif userRequest.status == 1 and endable %}
				<div style="text-align:center;">
					<button type="button" class="btn btn-default btn-lg initializeButton initializeContainer" style="line-height:20px;width:100%; max-width:500px;">{% trans 'stop_wait_initialize_download' %}</button>
				</div>
				{% endif %}
				<!-- hidden confirm modal -->
				<div id="confirm-modal" class="modal fade modal-confirm">
					<div class="modal-content">
						<div class="modal-header">
						</div>
						<div class="modal-body">
							<p>{% trans "are_you_sure_you_want_to_download_only_those_given" %}</p>
						</div>
						<div class="modal-footer">
							<button type="button" data-dismiss="modal" class="btn btn-danger" id="yes">{% trans "Yes" %}</button>
							<button type="button" data-dismiss="modal" class="btn btn-outline-secondary">{% trans "back" %}</button>
						</div>
					</div>
				</div>
				<form class="form-hidden" action="{% url 'pyha:initializeDownload' %}" id="initialize" method="post">
					<div class="form-group">
						<input type="hidden" id="requestid" name="requestid" value={{userRequest.id}}>
						<input type="hidden" id="next" name="next" value={{request.path}}>
						<input type="submit" class="btn" value="submit!" name="psubmit" Style="display: none;">
					{% csrf_token %}
					</div>
				</form>
      </div>
      {% endif %}

      <ul class="nav nav-tabs" role="tablist">
        <li id="change-history-tab" role="presentation" {% if next == "history" %} class="active" {% endif %} >
          <a href="#history" class="request-tab request-view-tab" data-toggle="tab" aria-controls="history" role="tab" {% if next == "history" %} aria-expanded="true" {% endif %}>
            <span>
              {% trans "changes_history" %}
            </span>
          </a>
        </li>
        <li id="contacts-tab" role="presentation" {% if next == "contacts" %} class="active" {% endif %} >
          <a href="#contacts" class="request-tab request-view-tab" data-toggle="tab" aria-controls="contact" role="tab"{% if next == "contacts" %} aria-expanded="true" {% endif %}>
            <span>
              {% trans 'contact_window' %}
            </span>
          </a>
        </li>
        <li id="arguments-tab" role="presentation" {% if next == "arguments" %} class="active" {% endif %} >
          <a href="#arguments" class="request-tab request-view-tab" data-toggle="tab" aria-controls="argument" role="tab"{% if next == "arguments" %} aria-expanded="true" {% endif %}>
            <span>
              {% trans 'argument_window' %}
            </span>
          </a>
        </li>
        <li id="request-tab" role="presentation" {% if next == "request" %} class="active" {% endif %} >
          <a href="#request" class="request-tab request-view-tab" data-toggle="tab" aria-controls="request" role="tab"{% if next == "request" %} aria-expanded="true" {% endif %}>
            <span>
              {% trans 'request_window' %}
            </span>
          </a>
        </li>
        <li id="filters-tab" role="presentation" {% if next == "filters" %} class="active" {% endif %} >
          <a href="#filters" class="request-tab request-view-tab" data-toggle="tab" aria-controls="filters" role="tab"{% if next == "filters" %} aria-expanded="true" {% endif %}>
            <span>
              {% trans 'filter_window' %}
            </span>
          </a>
        </li>
        <li id="decision-tab" role="presentation" {% if next == "decision" %} class="active" {% endif %} >
          <a href="#decision" class="request-tab {% if role == "handler" or role == "admin" %}request-{{role}}-action-tab{% else %}request-view-tab{% endif %}" data-toggle="tab" aria-controls="decision" role="tab"{% if next == "decision" %} aria-expanded="true" {% endif %}>
            <span>
              {% if role == "handler" or role == "admin" %}
              {% trans 'make_decision_window' %}
              {% else %}
              {% trans 'decision_window' %}
              {% endif %}
            </span>
          </a>
        </li>
        {% if role == "handler" or role == "admin" or requestInformationChat_list %}
        <li id="additional_information-tab" role="presentation" {% if next == "information" %} class="active" {% endif %} >
          <a href="#additional_information" class="request-tab request-{{role}}-action-tab" data-toggle="tab" aria-controls="additional_information" role="tab" {% if next == "information" %} aria-expanded="true" {% endif %}>
            <span>
              {% if role == "user" and userRequest.status == 6 %}<span class="glyphicon glyphicon-exclamation-sign"></span> {% endif %}{% trans 'additional_information_window' %}
            </span>
          </a>
        </li>
        {% endif %}
        {% if role == "handler" or role == "admin" %}
        <li id="handler_comments-tab" role="presentation" {% if next == "comments" %} class="active" {% endif %} >
    			<a href="#handler_comments" class="request-tab request-{{role}}-action-tab" data-toggle="tab" aria-controls="handler_comments" role="tab" {% if next == "comments" %} aria-expanded="true" {% endif %}>
    				<span>
    					{% trans 'col_handler_comments_window' %}
    				</span>
    			</a>
    		</li>
        {% endif %}
        {% if role == "admin" %}
        <li id="handler_communications-tab" role="presentation" {% if next == "communications" %} class="active" {% endif %} >
    			<a href="#handler_communications" class="request-tab request-{{role}}-action-tab" data-toggle="tab" aria-controls="handler_communications" role="tab" {% if next == "communications" %} aria-expanded="true" {% endif %}>
    				<span>
    					{% trans 'admin_communications_window' %}
    				</span>
    			</a>
    		</li>
        {% endif %}
      </ul>

      <div class="tab-content">
        <div class="request-view-pane tab-pane {% if next == 'history' %} active {% endif %}" role="tabpanel" id="history">
          {% include "pyha/skipofficial/history_tab.html" %}
        </div>
        <div class="request-view-pane tab-pane {% if next == 'contacts' %} active {% endif %}" role="tabpanel" id="contacts">
          {% include "pyha/skipofficial/contacts_tab.html" %}
        </div>
        <div class="request-view-pane tab-pane {% if next == 'arguments' %} active {% endif %}" role="tabpanel" id="arguments">
          {% include "pyha/skipofficial/arguments_tab.html" %}
        </div>
        <div class="request-view-pane tab-pane {% if next == 'request' %} active {% endif %}" role="tabpanel" id="request">
          {% include "pyha/skipofficial/request_tab.html" %}
        </div>
        <div class="request-view-pane tab-pane {% if next == 'filters' %} active {% endif %}" role="tabpanel" id="filters">
          {% include "pyha/skipofficial/filters_tab.html" %}
        </div>
        <div class="request-view-pane tab-pane {% if next == 'decision' %} active {% endif %}" role="tabpanel" id="decision">
          {% if role == "handler" or role == "admin" %}
          {% include "pyha/skipofficial/make_decision_tab.html" %}
          {% else %}
          {% include "pyha/skipofficial/decision_tab.html" %}
          {% endif %}
        </div>
      </div>

      {% block page_content %}
      {% endblock %}
    </div>
  </div>
</div>

{% endblock %}
