{% extends "pyha/base/base.html" %}
{% load i18n %}
{% block content %}

<div class="container-fluid">
  <div class="row">
    <div class="col-xs-12">
      <div class="page-header">
        {% include "pyha/skipofficial/requestview_header.html" %}
      </div>

  		<div class="col-xs-12">
  			{% if collections %}
  			<h2 style="text-align:center;top:0%;">{% trans "restricted" %}</h2>
  			<div>
  			<table class="table">
  				{% for collection in collections %}
  					<tr>
  					<td>{{collection.result.collectionName}} <small>[<a href="{{tun_link}}{{collection.address}}" target="_blank">{% trans 'to_metadata' %}</a>]</small></td>
  					<td>
  					<div class="slider-group" style="text-align:center;">
  						<span class="slider slider-{{role}}{% if collection.status == 1 %}-light{% endif %}">
                {% if role == "handler" %}
    								{% if collection.address in handles %}
    									{% trans "handler_waiting_for_you" %}
    								{% else %}
    									{% trans "handler_waiting_for_others" %}
    								{% endif %}
                {% else %}
                  {% trans "waiting_for_data_provider" %}
                {% endif %}
              </span>
  						<span class="slider slider-{{role}}{% if collection.status == 4 %}-light{% endif %}">{% trans "accepted" %}</span>
  						<span class="slider slider-{{role}}{% if collection.status == 3 %}-light{% endif %}">{% trans "denied" %}</span>
  					</div>
  					</td>
  				</tr>
  				{% endfor %}
  			</table>
  			</div>
  			{% endif %}
  		</div>

      {% if role == "user" %}
      <div class="col-xs-12">
				{% if userRequest.status == 8 %}
					{% if downloadable %}
						<div style="text-align:center;">
						<a href="{{download}}" type="button" class="btn btn-default btn-lg" style="line-height:20px;width:100%; max-width:500px;"><span class="glyphicon glyphicon-open-file"></span> {% trans 'download' %}</a>
						</div>
					{% else %}
						<h3 style="text-align:center;">{% trans 'download_has_expired' %}</h3>
					{% endif %}
				{% elif userRequest.status == 4  %}
				<div style="text-align:center;">
					<form action="{% url 'pyha:initializeDownload' %}" method="post">
						<button style="width:100%; max-width:500px;" class="btn btn-default btn-lg " style="line-height:20px;width:100%; max-width:500px;">{% trans 'initialize_download' %}</button>
						<input type="hidden" id="requestid" name="requestid" value={{userRequest.id}}>
						<input type="hidden" id="next" name="next" value={{request.path}}>
						{% csrf_token %}
					</form>
				</div>
				{% elif userRequest.status == 7%}
				<h3 style="text-align:center;">{% trans 'you_will_be_emailed_when_ready' %}</h3>
				{% elif userRequest.status == 1 and endable %}
				<div style="text-align:center;">
					<button type="button" class="btn btn-default btn-lg initializeButton initializeContainer" style="line-height:20px;width:100%; max-width:500px;">{% trans 'stop_wait_initialize_download' %}</button>
				</div>
				{% endif %}
				<!-- hidden confirm modal -->
				<div id="confirm-modal" class="modal fade modal-confirm">
					<div class="modal-content">
						<div class="modal-header">
						</div>
						<div class="modal-body">
							<p>{% trans "are_you_sure_you_want_to_download_only_those_given" %}</p>
						</div>
						<div class="modal-footer">
							<button type="button" data-dismiss="modal" class="btn btn-danger" id="yes">{% trans "Yes" %}</button>
							<button type="button" data-dismiss="modal" class="btn btn-outline-secondary">{% trans "back" %}</button>
						</div>
					</div>
				</div>
				<form class="form-hidden" action="{% url 'pyha:initializeDownload' %}" id="initialize" method="post">
					<div class="form-group">
						<input type="hidden" id="requestid" name="requestid" value={{userRequest.id}}>
						<input type="hidden" id="next" name="next" value={{request.path}}>
						<input type="submit" class="btn" value="submit!" name="psubmit" Style="display: none;">
					{% csrf_token %}
					</div>
				</form>
      </div>
      {% endif %}

      {% block page_content %}
      {% endblock %}
    </div>
  </div>
</div>

{% endblock %}
