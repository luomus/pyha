{% extends "pyha/base/base.html" %}
{% block content %}
{% load i18n %}

	<div class="container-fluid">
		<div class="col-xs-12">
			<div class="page-header">
				<h1>{% trans "admin_request_from_user" %}
					{{request_owner}},
					{{request_owners_email}}
				</h1>

				<h2>{{userRequest.date|date:"d.m.Y    H:i"}}</h2>
				<h2><span style="white-space: nowrap;">
						{% trans "admin_state_of_request" %}
						<span
						{% if userRequest.status == 1 %}
							 style="color:#AABBDD;"
						{% elif userRequest.status == 2 %}
							 style="color:#BBBB77;"
						{% elif userRequest.status == 3 %}
							 style="color:#DDBBAA;"
						{% elif userRequest.status == 4 %}
							 style="color:#99DD99;"
						{% else %}

						{% endif %}
						>
						{% if userRequest.status == 1 %}
							{% if userRequest.waitingstatus == 0 %}
							{% trans "admin_waiting_for_others" %}
							{% elif userRequest.waitingstatus == 1 %}
							{% trans "admin_waiting_for_you" %}
							{% endif %}
						{% elif userRequest.status == 2 %}
						{% trans "admin_partially_accepted" %}

						{% elif userRequest.status == 3 %}
						{% trans "admin_denied" %}

						{% elif userRequest.status == 4 %}
						{% trans "admin_accepted" %}

						{% elif userRequest.status == 6 %}
						{% trans "admin_waiting_for_additional_information" %}
						<a href="{{request.path}}?next=information" style="font-size:12px;white-space:normal;">{% trans "admin_show_additional_information" %}</a>
						{% elif userRequest.status == 7 %}
						{% trans "admin_waiting_for_download" %}

						{% elif userRequest.status == 8 %}
							{% if downloadable %}
								{% trans "admin_ready_for_download" %}
							{% else %}
								{% trans "admin_download_has_expired" %}
							{% endif %}

						{% else %}
						{% trans "admin_unknown" %}

						{% endif %}

						</span>
					</span>
				</h2>
				<form action="{% url 'pyha:freeze' %}" id="requestform" method="post">
					<div class="form-group stale-form" style>
						<input type="hidden" id="requestid" name="requestid" value={{userRequest.id}}>
						<input type="hidden" id="next" name="next" value="{{request.path}}">
						{% if userRequest.frozen %}
						<h4 style="color:red">{% trans "admin_request_is_frozen" %}</h4>
						<button type="submit" id="submit" name="freeze" class="btn btn-default btn-sm" >{% trans "admin_unfreeze_request" %}</button>
						<p>{% trans 'admin_unfreeze_request_to_re-enable_access_and_actions_by_users_not_admin'%}</p>
						{% else %}
						<h4 style="color:green">{% trans 'admin_request_is_not_frozen'%}</h4>
						<button type="submit" id="submit" name="freeze" class="btn btn-default btn-sm" >{% trans "admin_freeze_request" %}</button>
						<p>{% trans 'admin_freeze_request_to_disable_access_and_actions_by_users_not_admin'%}</p>
						{% endif %}
					</div>
					{% csrf_token %}
				</form>
			</div>
			<div style="padding-left:0px;">
					{% if taxon %}
					<div class="col-xs-12" style="height:relative">
							<h2 style="text-align:center;">{% trans "admin_sensitive" %}</h2>
							<div style="text-align:center;">
								<h3 class="slider-group" style="vertical-align:middle;margin-bottom:20px;margin-top:5px;">
									<span class="slider slider-lg slider-admin{% if userRequest.sensStatus == 1 %}-light{% endif %}">{% trans "admin_waiting" %}</span>
									<span class="slider slider-lg slider-admin{% if userRequest.sensStatus == 4 %}-light{% endif %}">{% trans "accepted" %}</span>
									<span class="slider slider-lg slider-admin{% if userRequest.sensStatus == 3 %}-light{% endif %}">{% trans "denied" %}</span>
								</h3>
							</div>
					</div>
					{% endif %}
					{% if collections %}
					<div class="col-xs-12">
						<h2 style="text-align:center;top:0%;">{% trans "admin_restricted" %}</h2>
						<div style= "{% if userRequest.sensStatus == 3%}opacity: 0.5;{% endif %}">
						<table class="table">
							{% for collection in collections %}
								<tr>
								<td><a href="{{tun_link}}{{collection.address}}" target="_blank">{{collection.result.collectionName}}</a></td>
								<td>
								<div class="slider-group" style="text-align:center;">
									<span class="slider slider-admin{% if collection.status == 1 %}-light{% elif collection.customSecured == 0 and userRequest.sensStatus == 1 %}-light{% endif %}">{% trans "admin_waiting" %}</span>
									<span class="slider slider-admin{% if collection.status == 4 %}-light{% elif collection.customSecured == 0 and userRequest.sensStatus == 4 %}-light{% endif %}">{% trans "accepted" %}</span>
									<span class="slider slider-admin{% if collection.status == 3 %}-light{% endif %}">{% trans "denied" %}</span>
								</div>
								</td>
							</tr>
							{% endfor %}
						</table>
						</div>
					</div>
					{% endif %}
			</div>
				<ul class="nav nav-tabs" role="tablist">
					<li id="change-history-tab" role="presentation" {% if next == "history" %} class="active" {% endif %} >
						<a href="#history" class="request-tab request-view-tab" data-toggle="tab" aria-controls="history" role="tab" {% if next == "history" %} aria-expanded="true" {% endif %}>
							<span>
								{% trans "admin_changes_history" %}
							</span>
						</a>
					</li>
					<li id="contacts-tab" role="presentation" {% if next == "contacts" %} class="active" {% endif %} >
						<a href="#contacts" class="request-tab request-view-tab" data-toggle="tab" aria-controls="contacts" role="tab" {% if next == "contacts" %} aria-expanded="true" {% endif %}>
							<span>
								{% trans 'admin_contact_window' %}
							</span>
						</a>
					</li>
					<li id="arguments-tab" role="presentation" {% if next == "arguments" %} class="active" {% endif %} >
						<a href="#arguments" class="request-tab request-view-tab" data-toggle="tab" aria-controls="arguments" role="tab" {% if next == "arguments" %} aria-expanded="true" {% endif %}>
							<span>
								{% trans 'admin_argument_window' %}
							</span>
						</a>
					</li>
					<li id="request-tab" role="presentation" {% if next == "request" %} class="active" {% endif %} >
						<a href="#request" class="request-tab request-view-tab" data-toggle="tab" aria-controls="request" role="tab" {% if next == "request" %} aria-expanded="true" {% endif %}>
							<span>
								{% trans 'admin_request_window' %}
							</span>
						</a>
					</li>
					<li id="filters-tab" role="presentation" {% if next == "filters" %} class="active" {% endif %} >
						<a href="#filters" class="request-tab request-view-tab" data-toggle="tab" aria-controls="filters" role="tab" {% if next == "filters" %} aria-expanded="true" {% endif %}>
							<span>
								{% trans 'admin_filter_window' %}
							</span>
						</a>
					</li>
					<li id="terms-tab" role="presentation" {% if next == "terms" %} class="active" {% endif %} >
						<a href="#terms" class="request-tab request-view-tab" data-toggle="tab" aria-controls="terms" role="tab" {% if next == "terms" %} aria-expanded="true" {% endif %}>
							<span>
								{% trans 'admin_terms_window' %}
							</span>
						</a>
					</li>
					<li id="decision-tab" role="presentation" {% if next == "decision" %} class="active" {% endif %} >
						<a href="#decision" class="request-tab request-admin-action-tab" data-toggle="tab" aria-controls="decision" role="tab" {% if next == "decision" %} aria-expanded="true" {% endif %}>
							<span>
								{% trans 'admin_decision_window' %}
							</span>
						</a>
					</li>
					<li id="additional_information-tab" role="presentation" {% if next == "information" %} class="active" {% endif %} >
						<a href="#additional_information" class="request-tab request-admin-action-tab" data-toggle="tab" aria-controls="additional_information" role="tab" {% if next == "information" %} aria-expanded="true" {% endif %}>
							<span>
								{% if userRequest.sensStatus == 1 and information %}<span class="glyphicon glyphicon-exclamation-sign"></span> {% endif %}{% trans 'admin_additional_information_window' %}
							</span>
						</a>
					</li>
					<li id="admin_comments-tab" role="presentation" {% if next == "comments" %} class="active" {% endif %} >
						<a href="#admin_comments" class="request-tab request-admin-action-tab" data-toggle="tab" aria-controls="admin_comments" role="tab" {% if next == "comments" %} aria-expanded="true" {% endif %}>
							<span>
								{% trans 'admin_comments_window' %}
							</span>
						</a>
					</li>
					<li id="handler_communications-tab" role="presentation" {% if next == "communications" %} class="active" {% endif %} >
						<a href="#handler_communications" class="request-tab request-admin-action-tab" data-toggle="tab" aria-controls="handler_communications" role="tab" {% if next == "communications" %} aria-expanded="true" {% endif %}>
							<span>
								{% trans 'admin_communications_window' %}
							</span>
						</a>
					</li>
				</ul>
				<div class="tab-content">
					<div class="request-view-pane tab-pane {% if next == 'request' %} active {% endif %}" role="tabpanel" id="request">
						<h3>{% trans "admin_collections_in_request" %}</h3>
						{% if taxon %}
						<p>{% trans "Collections including sensitive sightings are marked with symbol"%} <span class="glyphicon glyphicon-eye-open" style="color:red;"></span></p>
						<p>{% trans 'given_values_are_not_absolute' %}</p>
						{% endif %}
							<table class="table" style="width:100%">
								<tr style=color:black>
									<th>{% trans "admin_collection_name" %}</th>
									<th></th>
									<th>{% trans "admin_collection_description" %}</th>
									<th>{% trans "admin_secured_by_data_provider" %}</th>
									<th>{% trans "admin_generally_secured" %}</th>
									<th>{% trans "admin_all_secured" %}</th>
									{% if has_quarantine %}
										<th>{% trans "admin_secured_by_quarantine" %}</th>
									{% endif %}
									<th>{% trans "admin_state_of_processing" %}</th>
								</tr>
							{% for collection in collections %}
								{% if collection.status == 1 %}
								<tr class="info clickable-row">
								{% elif collection.status == 3 %}
								<tr class="danger clickable-row">
								{% elif collection.status == 4 %}
								<tr class="success clickable-row">
								{% elif collection.taxonSecured > 0 %}
									{% if userRequest.sensStatus == 1 %}
									<tr class="info clickable-row">
									{% elif userRequest.sensStatus == 3 %}
									<tr class="danger clickable-row">
									{% elif userRequest.sensStatus == 4 %}
									<tr class="success clickable-row">
									{% endif %}
								{% else %}
								<tr>
								{% endif %}
								<td><a href="{{tun_link}}{{collection.address}}" target="_blank">{{collection.result.collectionName}}</a></td>
								{% if collection.taxonSecured > 0 %}<td><span class="glyphicon glyphicon-eye-open" style="color:red;"></span></td>{% else %}<td></td>{% endif %}
								<td>{{collection.result.description}}</td>
								<td>{{collection.customSecured}}</td>
								<td>{{collection.taxonSecured}}</td>
								<td>{{collection.allSecured}}</td>
								{% if has_quarantine %}
									<td>{{collection.quarantineSecured}}</td>
								{% endif %}
								{% if collection.status == 1 %}
									{% if collection.address in handles %}
									<td>{% trans "admin_waiting_for_you" %}</td>
									{% else %}
									<td>{% trans "admin_waiting_for_others" %}</td>
									{% endif %}
								{% elif collection.status == 3 %}
								<td>{% trans "denied" %}</td>
								{% elif collection.status == 2 %}
								<td>{% trans "partially_accepted" %}</td>
								{% elif collection.status == 4 %}
								<td>{% trans "accepted" %}</td>
								{% elif collection.taxonSecured > 0 %}
								<td>{% trans "Admission_for_sensitive_data" %}</td>
								{% else %}
								<td>{% trans "unknown" %}</td>
								{% endif %}
							{% endfor %}
						</table>
					</div>
					<div class="request-view-pane tab-pane {% if next == 'filters' %} active {% endif %}" role="tabpanel" id="filters">
						<h3>{% trans "admin_request_filters" %} </h3> <a style="padding-left:8px;" {% if role1 %}href="{{ official_filter_link }}" target="_blank">{% trans "admin_show_in_officials_portal" %}{% else %}href="{{ filter_link }}">{% trans "admin_show_in_portal" %}{% endif %}</a>
							{% if filters %}
								<table class = "table" style="width:100%">
									<tr style=color:black>
										<th>{% trans "admin_filter" %}</th>
										<th>{% trans "admin_values" %}</th>
									</tr>
									{% for filter in filters %}
									<tr>
										<td rowspan={{filter.1|length}}>{{ filter.2 }}</td>
										{% for f in filter.1 %}
										<td>{{ f }}</td>
									</tr>
										<tr>
										{% endfor %}
										</tr>
									{% endfor %}
								</table>
								{% if coordinates %}
								<div id="filtermap"></div>
								{% endif %}
							{% else %}
								<strong>{% trans "admin_no_filters" %}.</strong>
							{% endif %}
					</div>
					<div class="request-view-pane tab-pane {% if next == 'arguments' %} active {% endif %}" role="tabpanel" id="arguments">
						<h3>{% trans "request_arguments" %}</h3>
					<table class="table" style="width:100%">
					<tr style=color:black><th>{% trans "admin_argument_choices" %}</th></tr>
					<tr><td>
					{% for choice in reasonlist.argument_choices%}
						{% if choice == 'reason_zoning' %}
							<p>{% trans "admin_reason_zoning" %}{% if not forloop.last %},{% endif %}</p>
						{% elif choice == 'reason_permission' %}
							<p>{% trans "admin_reason_permission" %}{% if not forloop.last %},{% endif %}</p>
						{% elif choice == 'reason_enviromental' %}
							<p>{% trans "admin_reason_enviromental" %}{% if not forloop.last %},{% endif %}</p>
						{% elif choice == 'reason_natura' %}
							<p>{% trans "admin_reason_natura" %}{% if not forloop.last %},{% endif %}</p>
						{% elif choice == 'reason_scientific' %}
							<p>{% trans "admin_reason_scientific" %}{% if not forloop.last %},{% endif %}</p>
						{% elif choice == 'reason_forest' %}
							<p>{% trans "admin_reason_forest" %}{% if not forloop.last %},{% endif %}</p>
						{% elif choice == 'reason_other' %}
							<p>{% trans "admin_reason_other" %}{% if not forloop.last %},{% endif %}</p>
						{% endif %}
					{% endfor %}
					</td></tr>
					{% for field in reasonlist.fields %}
						{% if field.0 == 'argument_project' %}
							<tr style=color:black><th>{% trans "admin_argument_project" %}</th></tr>
							<tr><td><p>{{field.1}}</p></td></tr>
						{% elif field.0 == 'argument_research' %}
							<tr style=color:black><th>{% trans "admin_argument_research" %}</th></tr>
							<tr><td><p>{{field.1}}</p></td></tr>
						{% elif field.0 == 'argument_research_address' %}
							<tr style=color:black><th>{% trans "argument_research_address" %}</th></tr>
							<tr><td><p>{{field.1}}</p></td></tr>
						{% elif field.0 == 'argument_goals' %}
							<tr style=color:black><th>{% trans "admin_argument_goals" %}</th></tr>
							<tr><td><p>{{field.1}}</p></td></tr>
						{% elif field.0 == 'argument_planning' %}
							<tr style=color:black><th>{% trans "admin_argument_planning" %}</th></tr>
							<tr><td><p>{{field.1}}</p></td></tr>
						{% elif field.0 == 'argument_municipality' %}
							<tr style=color:black><th>{% trans "admin_argument_municipality" %}</th></tr>
							<tr><td><p>{{field.1}}</p></td></tr>
						{% elif field.0 == 'argument_natura_areas' %}
							<tr style=color:black><th>{% trans "admin_argument_natura_areas" %}</th></tr>
							<tr><td><p>{{field.1}}</p></td></tr>
						{% elif field.0 == 'argument_reason' %}
							<tr style=color:black><th>{% trans "admin_argument_reason" %}</th></tr>
							<tr><td><p>{{field.1}}</p></td></tr>
						{% endif %}
					{% endfor %}
						</table>
					</div>
					<div class="request-view-pane tab-pane {% if next == 'terms' %} active {% endif %}" role="tabpanel" id="terms">
							<h3>{% trans "admin_terms" %}</h3>
							<table class="table" style="width:100%">
								{% if taxon %}
								<tr>
								<td>{% trans "admin_sensitivity" %}</td>
								<td><button type="button" class="btn btn-default btn-sm" required data-toggle="modal" data-target="#myModalsens">{% trans "admin_terms" %}</button></td>
								</tr>
								{% endif %}
								{% for collection in customlist %}
									<tr>
									<td><a href="{{tun_link}}{{collection.address}}" target="_blank">{{collection.result.collectionName}}</a></td>
									<td><button type="button" class="btn btn-default btn-sm" required data-toggle="modal" data-target="#myModal{{ forloop.counter0 }}">{% trans "admin_terms" %}</button></td>
									</tr>
									<!-- Modal -->
									<div class="modal fade" id="myModal{{ forloop.counter0 }}" tabindex="-1" role="dialog" aria-labelledby="myModalLabel">
									  <div class="modal-dialog modal-lg" role="document">
										<div class="modal-content">
										  <div class="modal-header">
											<button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
											<h4 class="modal-title" id="myModalLabel">{% trans "admin_terms_of_use_of_the_collections" %}</h4>
											<button style="font-size:10px;" type="button" onclick="post('{% url 'pyha:newpdf' %}',{source: document.getElementById('custom-content-{{collection.address}}').outerHTML, csrfmiddlewaretoken: '{{ csrf_token }}'})" class="btn btn-default btn-sm">{% trans "as_pdf" %}</button>
										</div>
										<div id="custom-content-{{collection.address}}" class="modal-body" style="padding-left:20px;">
											<p>Curabitur in gravida felis. Sed non consequat ante. Phasellus eros turpis, maximus non tellus quis, egestas imperdiet mi. Nulla facilisi. Ut pulvinar vitae libero quis posuere. Vivamus hendrerit quam lacus, et consequat leo tincidunt vel. Sed quis tristique erat.</p>
											<p>Vivamus sit amet massa enim. Sed egestas, libero vitae rhoncus vehicula, odio eros feugiat ipsum, vitae euismod ligula eros non velit. Fusce in augue eu magna feugiat volutpat. Nunc pulvinar, velit eu sodales euismod, purus mauris sodales arcu, at commodo nisl nulla vitae nisl. Suspendisse hendrerit ex sem, in rutrum orci interdum quis. Aliquam rutrum aliquam mi, non consequat augue ultricies sed. Integer fringilla in sem sed feugiat. Nullam non nisi ultrices, mollis lacus vel, venenatis nunc. Integer at lorem sed turpis euismod efficitur eget at sapien. Nullam nec diam purus.</p>
											<p>Sed leo nulla, porta vel ligula eu, fringilla pharetra felis. Phasellus lorem sem, mollis non elementum vitae, varius nec ex. Proin vulputate malesuada nulla, in aliquam lacus. Aliquam sit ametplacerat elit. Mauris elementum porta est, feugiat molestie purus laoreet nec.</p>
											<p>Duis eleifend justo tortor, eget sollicitudin ipsum elementum fringilla. Donec sit amet lorem at urna auctor consectetur et vitae mi. Nulla facilisi. Nunc finibus enim vel leo consequat, mollis dapibus odio molestie. Curabitur non neque eleifend, aliquam felis et, pharetra massa. In hac habitasse platea dictumst. Nam id fermentum ipsum. Maecenas felis est, aliquet sit amet nisl in, vulputate varius est.</p>
											<p>Etiam feugiat mauris quam, sed facilisis enim fermentum at. In finibus at augue eu pulvinar. Nulla dapibus elementum erat, luctus vulputate tortor vulputate et. Nam mi arcu, dignissim id lorem sed, consectetur euismod justo. Curabitur vitae nunc tortor. Maecenas vestibulum consequat tellus nec dictum. In luctus nisi metus, in pharetra nulla fringilla eget. Vestibulum ac urna non arcu tincidunt vestibulum. Curabitur ut neque urna. Phasellus eu turpis mi. Duis mollis sem eu elit suscipit maximus. Donec eu bibendum ipsum. Maecenas cursus ex erat.</p>
											<p>Morbi nec vestibulum sem. Nam at augue at sapien dapibus rutrum quis et mauris. Nunc fermentumnibh risus, id volutpat quam fringilla et. Pellentesque porta, risus eget mattis vestibulum, orci diam elementum leo, quis viverra ligula felis tristique odio. Donec pellentesque odio non nulla fringilla condimentum. Nulla facilisi. Nam rhoncus ex quis aliquam tristique. Morbi aliquet pulvinar tincidunt. Sed vulputate accumsan eros eu semper. Nunc mollis tristique mattis. Donec et porta ex.</p>
											<p>In nisi leo, elementum et quam vitae, elementum placerat erat. Vestibulum eleifend, mauris at feugiat vulputate, purus lorem pellentesque purus, ac efficitur arcu dui id velit. In ultricies dapibus magna quis maximus. Vestibulum vulputate felis nec finibus ultrices. Nam ultricies rhoncus semper.</p>
										</div>
										  <div class="modal-footer">
											<button type="button" class="btn btn-default" data-dismiss="modal" id=>{% trans "admin_exit" %}</button>
										  </div>
										</div>
									  </div>
									</div>
								{% endfor %}
									<!-- Sens Modal -->
									<div class="modal fade" id="myModalsens" tabindex="-1" role="dialog" aria-labelledby="sensiModalLabel">
									  <div class="modal-lg modal-dialog" role="document">
										<div class="modal-content">
											<div class="modal-header">
											<button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
											<h4 class="modal-title" id="myModalLabel">{% trans "admin_sensitive_terms" %}</h4>
											<form action="{% url 'pyha:newpdf' %}" onsubmit="this.source.value=document.getElementById('sens-content').outerHTML" method="post">
												<button type="submit" class="btn btn-default btn-sm">{% trans "admin_as_pdf" %}</button>
												<input type="hidden" name="source" />
												{% csrf_token %}
											</form>
											</div>
											<div id="sens-content" class="modal-body">
											<div style="float:left;">
											<svg xmlns="http://www.w3.org/2000/svg"
												width="60" height="160" version="1.1" baseProfile="full"
												style="width: 60px; height: 160px; display: block;">
												<g transform="rotate(270)">
													<text textLength="160" fill="#777777" font-weight="700" font-size="50px" style="font-family: Arial, Helvetica, sans-serif;">
														<tspan x="-160" dy="50" >LAJI.FI</tspan>
													</text>
												   </g>
											  </svg>
											</div>
											<div style="margin-left:120px;margin-top:50px;">
												{% include sensitivity_terms %}
												<div style="margin-left:30px">
												<ul>
													<li><p class="model-field">{% trans 'contact_name' %} {{contactlist.0.personName}}</p></li>
													<ul>
													<li><p class="model-field">{% trans 'contact_street_address' %} {{contactlist.0.personStreetAddress}}</p></li>
													<li><p class="model-field">{% trans 'contact_postal' %} {{contactlist.0.personPostalCode}}</p></li>
													<li><p class="model-field">{% trans 'contact_post_office' %} {{contactlist.0.personPostOfficeName}}</p></li>
													<li><p class="model-field">{% trans 'contact_country' %} {{contactlist.0.personCountry}}</p></li>
													<li><p class="model-field">{% trans 'contact_email' %} {{contactlist.0.personEmail}}</p></li>
													<li><p class="model-field">{% trans 'contact_phone_number' %} {{contactlist.0.personPhoneNumber}}</p></li>
													{% if contactlist.0.personOrganizationName != "" %}
													<li><p class="model-field">{% trans 'contact_corporation' %} {{contactlist.0.personOrganizationName}}</p></li>
													{% endif %}
													{% if contactlist.0.personCorporationId != "" %}
													<li><p class="model-field">{% trans 'contact_corporation_id' %} {{contactlist.0.personCorporationId}}</p></li>
													{% endif %}
													</ul>
												</ul>
													{% for contact in contactlist|slice:"1:" %}
												<p style="width:100%;height:12px;"></p>
												<ul>
													<li><p class="model-field">{% trans 'additional_contact_name' %} {{contact.personName}}</p></li>
													<ul>
													<li><p class="model-field">{% trans 'contact_street_address' %} {{contact.personStreetAddress}}</p></li>
													<li><p class="model-field">{% trans 'contact_postal' %} {{contact.personPostalCode}}</p></li>
													<li><p class="model-field">{% trans 'contact_post_office' %} {{contact.personPostOfficeName}}</p></li>
													<li><p class="model-field">{% trans 'contact_country' %} {{contact.personCountry}}</p></li>
													<li><p class="model-field">{% trans 'contact_email' %} {{contact.personEmail}}</p></li>
													<li><p class="model-field">{% trans 'contact_phone_number' %} {{contact.personPhoneNumber}}</p></li>
													{% if contact.personOrganizationName != "" %}
													<li><p class="model-field">{% trans 'contact_corporation' %} {{contact.personOrganizationName}}</p></li>
													{% endif %}
													{% if contact.personCorporationId != "" %}
													<li><p class="model-field">{% trans 'contact_corporation_id' %} {{contact.personCorporationId}}</p></li>
													{% endif %}
													</ul>
												</ul>
													{% endfor %}
												</div>
											</div>
										  </div>
										  <div class="modal-footer">
											<button type="button" class="btn btn-default" data-dismiss="modal" id=>{% trans "admin_exit" %}</button>
										  </div>
										</div>
									  </div>
									</div>
							</table>
					</div>
					<div class="request-view-pane tab-pane {% if next == 'contacts' %} active {% endif %}" role="tabpanel" id="contacts">
						<h3>{% trans "admin_contacts" %}</h3>
						<table class="table" style="width:100%">
							<tr style=color:black>
								<th>{% trans "admin_full_name" %}</th>
								<th>{% trans "admin_street_address" %}</th>
								<th>{% trans "admin_postal_code" %}</th>
								<th>{% trans "admin_post_office_name" %}</th>
								<th>{% trans "admin_country" %}</th>
								<th>{% trans "admin_email" %}</th>
								<th>{% trans "admin_phone_number" %}</th>
								<th>{% trans "admin_corporation/organization_name" %}</th>
								<th>{% trans "admin_corporation_id" %}</th>
							</tr>
								{% for contact in contactlist %}
							<tr>
								<td>{{contact.personName}}</td>
								<td>{{contact.personStreetAddress}}</td>
								<td>{{contact.personPostalCode}}</td>
								<td>{{contact.personPostOfficeName}}</td>
								<td>{{contact.personCountry}}</td>
								<td>{{contact.personEmail}}</td>
								<td>{{contact.personPhoneNumber}}</td>
								<td>{{contact.personOrganizationName}}</td>
								<td>{{contact.personCorporationId}}</td>
							</tr>
								{% endfor %}
						</table>
					</div>
					<div class="request-view-pane tab-pane {% if next == 'decision' %} active {% endif %}" role="tabpanel" id="decision">
							{% if userRequest.sensStatus == 0 %}
							<h3>{% trans "admin_user_no_sensitive_data"%}</h3>
							{% else %}
							<h3>{% trans "admin_list_of_collections"%}</h3>
							{% for collection in taxonlist %}
								<span>{{collection.result.collectionName}}{% if not forloop.last %},{% endif %}</span>
							{% endfor %}
							<br><br />
							<table class="table" style="width:100%">
								<tr style=color:black>
								<th>{% trans "admin_state_of_processing" %}</th>
								<th>{% trans "admin_decision_arguments" %}</th>
								</tr>
								{% if userRequest.sensStatus == 1 %}
								<tr class="info clickable-row">
								{% elif userRequest.sensStatus == 3 %}
								<tr class="danger clickable-row">
								{% elif userRequest.sensStatus == 4 %}
								<tr class="success clickable-row">
								{% else %}
								<tr>
								{% endif %}
								{% if userRequest.sensStatus == 1 %}
									{% if role1 %}
										<td>{% trans "admin_waiting_for_you" %}</td>
									{% else %}
										<td>{% trans "admin_waiting_for_others" %}</td>
									{% endif %}
								{% elif userRequest.sensStatus == 3 %}
								<td>{% trans "admin_denied" %}</td>
								{% elif userRequest.sensStatus == 2 %}
								<td>{% trans "admin_partially_accepted" %}</td>
								{% elif userRequest.sensStatus == 4 %}
								<td>{% trans "admin_accepted" %}</td>
								{% elif userRequest.sensStatus == 99 %}
								<td>{% trans "admin_skipped" %}</td>
								{% else %}
								<td>{% trans "admin_unknown" %}</td>
								{% endif %}
								<td style="width:100%;">
									<form action="{% url 'pyha:answer' %}" id="requestform" method="post" style="display:inline-block;">
									<div class="form-group">
										<input type="hidden" id="collectionid" name="collectionid" value="sens">
										<input type="hidden" id="next" name="next" value="{{request.path}}?next=decision">
										<input type="hidden" id="requestid" name="requestid" value={{userRequest.id}}>
										<button type="submit" id="submit" name="answer" value=1 class="btn btn-default btn-sm" {% if userRequest.frozen %} disabled {% endif %}>{% trans "admin_accept" %}</button>
									</div>
									{% csrf_token %}
									</form>
									<label for="submit-decline" class="btn btn-default btn-sm" {% if userRequest.frozen %} disabled {% endif %}>{% trans "admin_refuse" %}</label>
									<form action="{% url 'pyha:answer' %}" id="sensitiveform" method="post" style="padding-top:20px;">
									<button type="hidden" id="submit-decline" onclick="showDecline()" type="submit" name="answer" value=0 style="display:none;" {% if userRequest.frozen %} disabled {% endif %}>{% trans "admin_refuse" %}</button>
									<div class="form-group" style="position: relative;top:-30px;">
										<input type="hidden" id="collectionid" name="collectionid" value="sens">
										<input type="hidden" id="next" name="next" value="{{request.path}}?next=decision">
										<input type="hidden" id="requestid" name="requestid" value={{userRequest.id}}>
										<div id="sensitive_refuse_form" style="width:100%;display:{% if userRequest.sensStatus == 3 %}block{% else %}none{% endif %};">
										<textarea class="form-control" rows="10" cols="700" id="reason" name="reason" required {% if userRequest.frozen %} disabled {% endif %}>{% if userRequest.sensDecisionExplanation %}{{userRequest.sensDecisionExplanation}}{% else %}{% endif %}</textarea>
										</div>
									</div>
									{% csrf_token %}
									</form>
								</td>
								</tr>
							</table>
							{% endif %}
						{% if customlist %}
							<h3>{% trans "admin_secured_collection_decicions" %}</h3>
								<table class="table" style="width:100%">
									<tr style=color:black>
										<th>{% trans "admin_collection_name" %}</th>
										<th>{% trans "admin_collection_description" %}</th>
										<th>{% trans "admin_state_of_processing" %}</th>
										<th>{% trans "admin_decision_arguments" %}</th>
									</tr>
									{% for collection in customlist %}
										{% if collection.status == 1 %}
										<tr class="info clickable-row">
										{% elif collection.status == 3 %}
										<tr class="danger clickable-row">
										{% elif collection.status == 4 %}
										<tr class="success clickable-row">
										{% else %}
										<tr>
										{% endif %}
										<td>{{collection.result.collectionName}}</td>
										<td>{{collection.result.description}}</td>

										{% if collection.status == 1 %}
											{% if collection.address in handles %}
											<td>{% trans "admin_waiting_for_you" %}</td>
											{% else %}
											<td>{% trans "admin_waiting_for_others" %}</td>
											{% endif %}
										{% elif collection.status == 3 %}
										<td>{% trans "admin_denied" %}</td>
										{% elif collection.status == 2 %}
										<td>{% trans "admin_partially_accepted" %}</td>
										{% elif collection.status == 4 %}
										<td>{% trans "admin_accepted" %}</td>
										{% else %}
										<td>{% trans "admin_unknown" %}</td>
										{% endif %}
									<td>
								<form action="{% url 'pyha:answer' %}" id="requestform" method="post">
								<div class="form-group">
										<input type="hidden" id="collectionid" name="collectionid" value={{collection.address}}>
										<input type="hidden" id="requestid" name="requestid" value={{userRequest.id}}>
										<input type="hidden" id="next" name="next" value="{{request.path}}?next=decision">
										<textarea class="form-control" rows="5" cols="700" id="reason" name="reason">{% if collection.decisionExplanation %}{{collection.decisionExplanation}}{% else %}{% endif %}</textarea>
										<button type="submit" id="submit" name="answer" value=1 class="btn btn-default btn-sm" {% if userRequest.frozen %} disabled {% endif %}>{% trans "admin_accept" %}</button>
										<button type="submit" id="submit" name="answer" value=3 class="btn btn-default btn-sm" {% if userRequest.frozen %} disabled {% endif %}>{% trans "admin_reset" %}</button>
										<button type="submit" id="submit" name="answer" value=0 class="btn btn-default btn-sm" {% if userRequest.frozen %} disabled {% endif %}>{% trans "admin_refuse" %}</button>
									</div>
									{% csrf_token %}
								</form>
							</td>
							</tr>
							{% endfor %}
						</table>
						{% endif %}
					</div>
					<div class="request-view-pane tab-pane {% if next == 'information' %} active {% endif %}" role="tabpanel" id="additional_information">
						<h3>{% trans "admin_additional_questions" %}</h3>
						{% for question in requestInformationChat_list %}
							{% if question.question %}
							<div class="panel panel-default" {% if question.user == user %} style="background-color:#d9edf7;" {% endif %}>
							<div class="panel-body"><p>{{question.date|date:"d.m.Y H:i"}} {{ question.name }} {% if question.target == 'sens' %} ({% trans 'sensitivity' %}) {% elif question.target == 'admin' %} ({% trans 'admin_question' %}) {% else %} ({{ question.result.collectionName }}) {% endif %} {% trans "admin_asked" %}&#10;&#13;{{question.message}}</p></div>
							</div>
							{% endif %}
							{% if question.question != True %}
							<div class="panel panel-default" {% if question.user == user %} style="background-color:#d9edf7;" {% endif %}>
							<div class="panel-body"><p>{{question.date|date:"d.m.Y H:i"}} {{ question.name }} {% trans 'inquiry' %} {% if question.target == 'sens' %} ({% trans 'sensitivity' %}) {% elif question.target == 'admin' %} ({% trans 'admin_question' %}) {% else %} ({{ question.result.collectionName }}) {% endif %}{% trans "admin_answered" %}&#10;&#13;{{question.message}}</p></div>
							</div>
							{% endif %}
						{% endfor %}
						<h3>{% trans "admin_form_to_request_additional_information" %}</h3>
						<form action="{% url 'pyha:question' %}" id="requestform" method="post">
							<div class="form-group">
								<input type="hidden" id="requestid" name="requestid" value={{userRequest.id}}>
								<input type="hidden" id="next" name="next" value="{{request.path}}?next=information">
								{% if role1 %}
								<input type="hidden" id="target" name="target" value="sens">
								{% else %}
								<span>{% trans 'ask_as_admin_of'%}</span>
								<select id="target" name="target">
									<option value="admin">{% trans "as_admin" %}</option>
								</select>
								{% endif %}
								<textarea class="form-control" rows="5" cols="70" id="reason" name="reason" required {% if userRequest.frozen %} disabled {% endif %}>{% if collection.decisionExplanation %}{{collection.decisionExplanation}}{% else %}{% endif %}</textarea>
								<button type="submit" id="submit" name="answer" value=2 class="btn btn-default btn-sm" {% if userRequest.frozen %} disabled {% endif %}>{% trans "admin_request_additional_information" %}</button>
							</div>
							{% csrf_token %}
						</form>
					</div>
					{% if role1 %}
					<div class="request-view-pane tab-pane {% if next == 'comments' %} active {% endif %}" role="tabpanel" id="admin_comments">
						<div>
							<div>
								<h3>{% trans "admin_official_comment_area" %}</h3>
								{% for requestChat in requestSensitiveChat_list %}
								<div class="panel panel-default">
								<div class="panel-body" {% if requestChat.user == user %} style="background-color:#d9edf7;" {% endif %}><p>{{requestChat.date|date:"d.m.Y H:i"}} {{ requestChat.name }}{% trans "admin_said" %}&#10;&#13;{{ requestChat.message }}</p></div>
								</div>
								{% endfor %}
								<form action="{% url 'pyha:comment_sensitive' %}" id="commentform" method="post">
								<div class="form-group">
									<input type="hidden" id="collectionid" name="collectionid" value="sens">
									<input type="hidden" id="next" name="next" value="{{request.path}}?next=comments">
									<input type="hidden" id="requestid" name="requestid" value={{userRequest.id}}>
									<textarea class="form-control" rows="5" cols="700" id="commentsForAuthorities" name="commentsForAuthorities" style="overflow:auto;resize:none" required {% if userRequest.frozen %} disabled {% endif %}></textarea>
									<button type="submit" id="submit" name="answer" value=1 class="btn btn-default btn-sm" {% if userRequest.frozen %} disabled {% endif %}>{% trans "admin_save" %}</button>
								</div>
								{% csrf_token %}
								</form>
							</div>
						</div>
					</div>
					{% endif %}
					<div class="request-view-pane tab-pane {% if next == 'history' %} active {% endif %}" role="tabpanel" id="history">
						{% if requestLog_list %}
						<h3>{% trans "admin_changes_history" %}</h3>
						<table class="table" style="width:100%">
							<tr>
								<th>{% trans "admin_log_date" %}</th>
								<th>{% trans "admin_log_maker" %}</th>
								<th>{% trans "admin_log_role" %}</th>
								<th>{% trans "admin_log_description" %}</th>
							</tr>
							{% for requestLog in requestLog_list %}
							<tr>
								<td>{{requestLog.date|date:"d.m.Y    H:i"}}</td>
								<td>{{requestLog.name}} ({{requestLog.email}})</td>
								{% if requestLog.role == 'admin' %}
								<td>{% trans "admin_log_admin" %}</td>
								{% elif requestLog.role == 'handler' %}
								<td>{% trans "admin_log_handler" %}</td>
								{% elif requestLog.role == 'MA.admin' %}
								<td>{% trans "admin_log_admin" %}</td>
								{% elif requestLog.role == 'MA.sensitiveInformationApprovalRequestHandler' %}
								<td>{% trans "admin_log_sensitive_data_handler" %}</td>
								{% elif requestLog.role == 'MA.downloadRequestHandler' %}
								<td>{% trans "admin_log_collection_provider" %}</td>
								{% elif requestLog.role == 'MA.sensitiveInformationApprovalRequestHandler and MA.downloadRequestHandler' %}
								<td>{% trans "admin_log_sensitive_and_collections_handler" %}</td>
								{% elif requestLog.role == 'user' and userRequest.user == request.session.user_id %}
								<td>{{requestLog.name}}</td>
								{% else %}
								<td>{% trans "user" %}</td>
								{% endif %}
								{% if requestLog.action == 'VIEW' %}
								<td>{% trans "admin_log_viewed" %}</td>
								{% elif requestLog.action == 'ACC' %}
								<td>{% trans "admin_log_terms_accepted" %}</td>
								{% elif requestLog.action == 'POS' %}
									{% if requestLog.collection == None %}
									<td>{% trans "admin_log_sensitives_accepted" %}</td>
									{% else %}
									<td>{% trans "admin_log_collection_accepted" %} ({{ requestLog.collection.result.collectionName }}) </td>
									{% endif %}
								{% elif requestLog.action == 'POSOV' %}
									{% if requestLog.collection == None %}
									<td>{% trans "admin_log_sensitives_accepted_because_overdue" %}</td>
									{% else %}
									<td>{% trans "admin_log_collection_accepted_because_overdue" %} ({{ requestLog.collection.result.collectionName }}) </td>
									{% endif %}
								{% elif requestLog.action == 'RESET' %}
									{% if requestLog.collection == None %}
									<td>{% trans "admin_log_sensitives_reset" %}</td>
									{% else %}
									<td>{% trans "admin_log_collection_reset" %} ({{ requestLog.collection.result.collectionName }})</td>
									{% endif %}
								{% elif requestLog.action == 'NEG' %}
									{% if requestLog.collection == None %}
									<td>{% trans "admin_log_sensitives_denied" %}</td>
									{% else %}
									<td>{% trans "admin_log_collection_denied" %} ({{ requestLog.collection.result.collectionName }})</td>
									{% endif %}
								{% elif requestLog.action == 'NEGOV' %}
									{% if requestLog.collection == None %}
									<td>{% trans "admin_log_sensitives_denied_because_overdue" %}</td>
									{% else %}
									<td>{% trans "admin_log_collection_denied_because_overdue" %} ({{ requestLog.collection.result.collectionName }}) </td>
									{% endif %}
								{% endif %}
							</tr>
							{% endfor %}
						</table>
						{% else %}
						<strong>{% trans "log_no_history" %}.</strong>
						{% endif %}
					</div>

					<div class="request-view-pane tab-pane {% if next == 'communications' %} active {% endif %}" role="tabpanel" id="handler_communications">
						{% if handler_groups %}
						<form action="{% url 'pyha:refresh_collections_cache' %}" id="refreshform" method="post">
							<h3 id="communications_header">
								{% trans "admin_communications_window" %}
								<input type="hidden" id="next" name="next" value="{{request.path}}?next=communications">
								<button type="submit" id="submit_refresh" name="send" value=1 class="btn btn-default btn-sm">{% trans "admin_refresh_collections_cache" %}</button>
								{% csrf_token %}
							</h3>
						</form>
						<form action="{% url 'pyha:send_email' %}" id="requestform" method="post">
							<table id="communications_table" class="table" style="width:100%;">
								<tr>
									<th>{% trans "admin_communications_collections" %}</th>
									<th style="text-align:right;">{% trans "admin_communications_handlers" %}</th>
									<th>{% trans "admin_communications_state" %}</th>
									<th>{% trans "admin_send_email" %}</th>
									<th>{% trans "admin_communications_email" %}</th>
								</tr>
								{% for group in handler_groups %}
									{% if group.handlers.0.id == 'None' %}
										<tr>
											<td colspan=2 style="vertical-align: middle;">
												<table class="collection-group-error" style="width:100%">
													<tr>
														<td style="border-bottom:0; width:100%">
														{% for collection in group.collections %}
															<p style="white-space: nowrap;"><a href="{{tun_link}}{{collection.id}}" target="_blank">{{ collection.collectionName }}</a></p>
														{% endfor %}
														</td>
														<td style="border-bottom:0;">
														{% for handler in group.handlers %}
															<p style="white-space: nowrap;">{% trans 'admin_name_is_none' %}</p>
														{% endfor %}
														</td>
													</tr>
												</table>
											</td>
											<td style="vertical-align: middle; line-height: 40px;">
												<p style="margin-bottom: 16px; color:red;">{% trans "admin_collections_missing_handler" %}</p>
											</td>
											<td></td>
											{% if forloop.first %}
											<td rowspan="{{handler_groups|length}}"  style="border:0px; border-top: 1px solid #ddd; border-left: 1px solid #ddd;">
													<div class="form-group">
														<input type="hidden" id="requestid" name="requestid" value={{userRequest.id}}>
														<input type="hidden" id="next" name="next" value="{{request.path}}?next=communications">
														<table style="width:100%;">
														<tr>
															<td style="border:0px;">{% trans "email_sender" %}</td>
															<td style="width:100%; border:0px;"><input type="text" id="com_email_sender" name="com_email_sender" value="{{ com_email_template.sender }}" style="width:100%;padding:6px 12px;"></td>
														</tr>
														<tr>
															<td style="border:0px;">{% trans "email_header" %}</td>
															<td style="width:100%; border:0px;"><input type="text" id="com_email_header" name="com_email_header" value="{{ com_email_template.header }}" style="width:100%;padding:6px 12px;"></td>
														</tr>
														<tr>
															<td style="border:0px;">{% trans "email_lang" %}</td>
															<td style="width:100%; border:0px;">
																<select onchange="refreshCommunicationsEmailByLang();" id="admin_com_email_lang" name="admin_com_email_lang" style="padding:0px 9px;">
																	{% for code in com_email_templates %}
																		<option {% if LANGUAGE == code %} selected="selected" {% endif %} value="{{ code }}">{{ code }}</option>
														            {% endfor %}
														            	<option value="all">{% trans "admin_email_lang_all" %}</option>
																</select>
																{% for code, values in com_email_templates.items %}
																<p hidden="true" id="com_email_header_{{ code }}">{{ values.header }}</p>
																<p hidden="true" id="com_email_content_{{ code }}">{{ values.content }}</p>
																{% endfor %}
															</td>
														</tr>
														</table>
														<textarea class="form-control" rows="15" cols="70" id="com_email_content" name="com_email_content">{{ com_email_template.content }}</textarea>
														<button type="submit" id="submit_email" name="send" value=1 class="btn btn-default btn-sm" {% if userRequest.frozen %} disabled {% endif %}>{% trans "admin_send" %}</button>
													</div>
											</td>
											{% endif %}
										</tr>
									{% else %}
										<tr>
											<td colspan=2 style="vertical-align: middle;">
												<table class="collection-group" style="width:100%">
													<tr>
														<td style="border-bottom:0; width:100%">
														{% for collection in group.collections %}
															<p style="white-space: nowrap;"><a href="{{tun_link}}{{collection.id}}" target="_blank">{{ collection.collectionName }}</a></p>
														{% endfor %}
														</td>
														<td style="border-bottom:0;">
														{% for handler in group.handlers %}
															<p style="white-space: nowrap; text-align:right;">[{{ handler.id }}] {{ handler.name }} ({{ handler.email }})</p>
														{% endfor %}
														</td>
													</tr>
												</table>
											</td>
											<td style="vertical-align: middle; line-height: 40px;">
												{% for handler in group.handlers %}
													{% if handler.mailed %}
														<p style="margin-bottom: 10px;">{% trans "emailed" %}</p>
													{% else %}
														<p style="margin-bottom: 10px;">{% trans "not_emailed" %}</p>
													{% endif %}
												{% endfor %}
													<div style="margin-bottom: 16px;"></div>
											</td>
											<td style="vertical-align: middle; line-height: 40px;">
												{% for handler in group.handlers %}
													<p style="white-space: nowrap;"><input {% if handler.mailed or frozen %} disabled {% endif %} onChange="enableCommunicationsEmail()" type="checkbox" name="email_id_{{ handler.id }}" value="{{ handler.email }}" style="margin-top: 0px; margin-left: 15px; vertical-align: middle;"></p>
												{% endfor %}
													<div style="margin-bottom: 16px;"></div>
											</td>
											{% if forloop.first %}
											<td rowspan="{{handler_groups|length}}"  style="border:0px; border-top: 1px solid #ddd; border-left: 1px solid #ddd;">
													<div class="form-group">
														<input type="hidden" id="requestid" name="requestid" value={{userRequest.id}}>
														<input type="hidden" id="next" name="next" value="{{request.path}}?next=communications">
														<table style="width:100%;">
														<tr>
															<td style="border:0px;">{% trans "email_sender" %}</td>
															<td style="width:100%; border:0px;"><input type="text" id="com_email_sender" name="com_email_sender" value="{{ com_email_template.sender }}" style="width:100%;padding:6px 12px;"></td>
														</tr>
														<tr>
															<td style="border:0px;">{% trans "email_header" %}</td>
															<td style="width:100%; border:0px;"><input type="text" id="com_email_header" name="com_email_header" value="{{ com_email_template.header }}" style="width:100%;padding:6px 12px;"></td>
														</tr>
														<tr>
															<td style="border:0px;">{% trans "email_lang" %}</td>
															<td style="width:100%; border:0px;">
																<select onchange="refreshCommunicationsEmailByLang();" id="admin_com_email_lang" name="admin_com_email_lang" style="padding:0px 9px;">
																	{% for code in com_email_templates %}
																		<option {% if LANGUAGE == code %} selected="selected" {% endif %} value="{{ code }}">{{ code }}</option>
														            {% endfor %}
														            	<option value="all">{% trans "admin_email_lang_all" %}</option>
																</select>
																{% for code, values in com_email_templates.items %}
																<p hidden="true" id="com_email_header_{{ code }}">{{ values.header }}</p>
																<p hidden="true" id="com_email_content_{{ code }}">{{ values.content }}</p>
																{% endfor %}
															</td>
														</tr>
														</table>
														<textarea class="form-control" rows="15" cols="70" id="com_email_content" name="com_email_content">{{ com_email_template.content }}</textarea>
														<button type="submit" id="submit_email" name="send" value=1 class="btn btn-default btn-sm" {% if userRequest.frozen %} disabled {% endif %}>{% trans "admin_send" %}</button>
													</div>
											</td>
											{% endif %}
										</tr>
									{% endif %}
								{% endfor %}
							</table>
							{% csrf_token %}
						</form>
						{% else %}
						<strong>{% trans "no_communications" %}</strong>
						{% endif %}
					</div>
			</div>
		</div>
	</div>

{% endblock %}

{% block end_script %}
	{% if coordinates %}
	<script>
		$(document).ready(function(){
			$('[data-toggle="tooltip"]').tooltip();
			initializeMap();
			map.setView([{{coordinates.5}}, {{coordinates.6}}], 7);
			document.getElementById('filters').style.display = 'block';
			map.invalidateSize();
			document.getElementById('filters').style.display = '';
			var bounds = [[{{coordinates.0}}, {{coordinates.2}}], [{{coordinates.1}},{{coordinates.3}}]];
			L.rectangle(bounds, {color: "#ff7800", weight: 1}).addTo(map);
		});
	</script>
	{% endif %}
	{% if next == 'comments' %}
	<script>
		$(document).ready(function(){
			document.getElementById('commentform').scrollIntoView();
		});
	</script>
	{% endif %}
	<script>
		function showDecline() {
			var x = document.getElementById('sensitive_refuse_form');
			if (x.style.display == 'none') {
				x.style.display = 'block';
			}
		}
	</script>
	<script>
		function refreshCommunicationsEmailByLang() {
			var x = document.getElementById('admin_com_email_lang');
			var strLang = x.options[x.selectedIndex].value;

			if (strLang == 'all'){
				document.getElementById('com_email_header').value = document.getElementById('com_email_header_fi').innerHTML;
				document.getElementById('com_email_content').value = '{%trans "in_other_languages_below"%}\n\n\n\n';
				{% for lang in languages %}
				document.getElementById('com_email_content').value += document.getElementById('com_email_content_{{ lang.code }}').innerHTML;
				document.getElementById('com_email_content').value += '\n\n------------------------------------';
					{% if not forloop.last %}
						document.getElementById('com_email_content').value += '\n\n\n';
					{% endif %}
				{% endfor %}
			} else {
				document.getElementById('com_email_header').value = document.getElementById('com_email_header_'+strLang).innerHTML;
				document.getElementById('com_email_content').value = document.getElementById('com_email_content_'+strLang).innerHTML;
			}

		}
	</script>
	<script>
	function enableCommunicationsEmail() {
		var x = document.querySelectorAll('[name^=email_id_]');
		var b = false;
		for (i = 0; i < x.length; i++){
			if(x[i].checked){
				b = true;
				break;
			}
		}
		{% if not userRequest.frozen %}
		document.getElementById('submit_email').disabled = !b;
		{% endif %}

	}
	</script>
	{% if next == 'information' %}
	<script>
		$(document).ready(function(){
			document.getElementById('additional_information').scrollIntoView();
			document.getElementById('requestform').scrollIntoView();
		});
	</script>
	{% endif %}
	{% if next == 'communications' %}
	<script>
		$(document).ready(function(){
			document.getElementById('handler_communications-tab').scrollIntoView();
		});
	</script>
	{% endif %}
	{% if next == 'decision' %}
	<script>
		$(document).ready(function(){
			document.getElementById('decision-tab').scrollIntoView();
		});
	</script>
	{% endif %}
	<script>
		$(document).ready(function(){
			refreshCommunicationsEmailByLang();
			enableCommunicationsEmail();
		});
	</script>
{% endblock %}

{% block modal %}
{% endblock %}
